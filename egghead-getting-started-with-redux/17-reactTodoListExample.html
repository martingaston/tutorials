<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Redux: Todo List Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.7.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.7.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { combineReducers, createStore } = Redux;
      const { Component } = React;

      const visibilityFilter = (state = "SHOW_ALL", action) => {
        switch (action.type) {
          case "SET_VISIBILITY_FILTER":
            return action.filter;
          default:
            return state;
        }
      };

      const todo = (state, action) => {
        switch (action.type) {
          case "ADD_TODO":
            return {
              id: action.id,
              text: action.text,
              completed: false
            };
          case "TOGGLE_TODO":
            if (state.id === action.id) {
              return {
                ...state,
                completed: !state.completed
              };
            } else {
              return state;
            }
          default:
            return state;
        }
      };

      const todos = (state = [], action) => {
        switch (action.type) {
          case "ADD_TODO":
            return [...state, todo(undefined, action)];
          case "TOGGLE_TODO":
            return state.map(t => todo(t, action));
          default:
            return state;
        }
      };

      const todoApp = combineReducers({ todos, visibilityFilter });
      const store = createStore(todoApp);
      let nextTodoId = 0;
      class TodoApp extends Component {
        render() {
          return (
            <div>
              <button
                onClick={() =>
                  store.dispatch({
                    type: "ADD_TODO",
                    text: "Test",
                    id: nextTodoId++
                  })
                }
              >
                Add Todo
              </button>
              <ul>
                {this.props.todos.map(t => (
                  <li>{t.text}</li>
                ))}
              </ul>
            </div>
          );
        }
      }

      const render = () => {
        ReactDOM.render(
          <TodoApp todos={store.getState().todos} />,
          document.getElementById("root")
        );
      };

      store.subscribe(render);
      render();
    </script>
  </body>
</html>
